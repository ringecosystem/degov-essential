generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model twitter_authorization {
  id          String  @id
  profile     String
  description String?
  enabled     Int     @default(0)

  access_token  String?
  access_secret String?

  user_id String?

  ctime DateTime @default(now())
  utime DateTime @updatedAt

  user twitter_user? @relation(fields: [user_id], references: [id])
}

model twitter_user {
  id String @id

  name          String?
  username      String
  avatar        String?
  profile_url   String?
  description   String?
  verified      Int?
  verified_type String?

  ctime DateTime @default(now())
  utime DateTime @updatedAt

  raw                   String
  twitter_authorization twitter_authorization[]
  twitter_tweet         twitter_tweet[]
}

model twitter_tweet {
  id String @id

  text            String?
  created_at      DateTime?
  author_id       String?
  conversation_id String?

  retweet_count Int?
  like_count    Int?
  reply_count   Int?
  from_agent    Int? @default(0) // indicates if the tweet was posted by an agent (e.g., bot)

  raw String?

  ctime DateTime @default(now())
  utime DateTime @updatedAt

  author       twitter_user?   @relation(fields: [author_id], references: [id])
  conversation twitter_tweet?  @relation("TweetConversation", fields: [conversation_id], references: [id])
  replies      twitter_tweet[] @relation("TweetConversation")
  degov_tweet  degov_tweet[]
}

model twitter_poll {
  id String @id

  duration_minutes Int?
  end_datetime     DateTime?
  voting_status    String?

  ctime DateTime @default(now())
  utime DateTime @updatedAt

  twitter_poll_option twitter_poll_option[]
}

model twitter_poll_option {
  id String @id

  label    String
  position Int
  votes    Int

  poll_id String?

  ctime DateTime @default(now())
  utime DateTime @updatedAt

  poll twitter_poll? @relation(fields: [poll_id], references: [id])
}

model degov_tweet {
  id String @id

  daocode     String
  proposal_id String
  chain_id    Int

  status          String // posted, fulfilled, error
  type            String // text, poll
  times_processed Int     @default(0) // number of times this tweet has been processed
  message         String?

  ctime DateTime @default(now())
  utime DateTime @updatedAt

  tweet twitter_tweet? @relation(fields: [id], references: [id])
}

model degov_dao_progress {
  id String @id

  code              String @unique
  last_block_number Int?

  ctime DateTime @default(now())
  utime DateTime @updatedAt
}
